# etcd.conf
#
# MANAGED BY ANSIBLE - DO NOT EDIT THIS FILE MANUALLY

name: {{ inventory_hostname }}
data-dir: {{ pg_setup_patroni_etcd_install_dir }}/data

listen-peer-urls: http://{{ ansible_host }}:2380
initial-advertise-peer-urls: http://{{ ansible_host }}:2380

listen-client-urls: http://{{ ansible_host }}:2379,http://127.0.0.1:2379
advertise-client-urls: http://{{ ansible_host }}:2379

{# Determine which etcd cluster group this host belongs to #}
{% set etcd_cluster_group = 'etcd_primary' if inventory_hostname in groups.get('etcd_primary', []) else 'etcd_secondary' %}
{% set etcd_cluster_name = etcd_cluster_group.replace('etcd_', '') %}
initial-cluster-token: patroni-etcd-{{ etcd_cluster_name }}
initial-cluster: {% for host in groups.get(etcd_cluster_group, []) %}{{ hostvars[host]['inventory_hostname'] }}=http://{{ hostvars[host]['ansible_host'] }}:2380{% if not loop.last %},{% endif %}{% endfor %}

initial-cluster-state: new
